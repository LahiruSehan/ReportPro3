<!DOCTYPE html>
<html lang="en" data-app-theme="bizsense">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>BIZSENSE STATEMENT PRO</title>
  
  <link rel="icon" type="image/png" href="https://i.ibb.co/7mmBhMJ/LOGO.png">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <!-- Chart.js for Trend Chart -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap');
    
    :root {
      --theme-primary: #6366f1;
      --theme-secondary: #f5f3ff;
      --theme-accent: #818cf8;
      --app-bg: #020205;
      --app-card: rgba(255, 255, 255, 0.03);
      --app-text: #ffffff;
      --app-border: rgba(255, 255, 255, 0.05);
    }

    body { background-color: var(--app-bg); color: var(--app-text); font-family: 'Inter', sans-serif; margin: 0; min-height: 100vh; overflow-x: hidden; }
    
    .view-hidden { display: none !important; }
    .glass-card { background: var(--app-card); backdrop-filter: blur(20px); border: 1px solid var(--app-border); border-radius: 1rem; }
    
    /* Global Select Styles */
    select, input[type="text"], input[type="password"], input[type="date"] { background: #1a1a2e !important; color: white !important; border: 1px solid var(--app-border) !important; padding: 0.75rem; border-radius: 0.75rem; outline: none; }
    
    /* Header Specific Select Fix */
    #select-organization {
      background: #1e1b4b !important; 
      color: #ffffff !important;
      border: 1px solid rgba(99, 102, 241, 0.5) !important;
      padding: 6px 12px !important;
      cursor: pointer;
      font-weight: 800;
      border-radius: 8px;
      appearance: auto;
    }
    #select-organization option { background: #1e1b4b; color: white; }

    /* A4 Pagination Preview Style */
    .a4-page {
      background: white; 
      color: #111; 
      padding: 10mm; 
      min-height: 297mm; 
      width: 210mm; 
      margin: 1cm auto; 
      box-shadow: 0 20px 50px rgba(0,0,0,0.4); 
      position: relative; 
      transform-origin: top center;
      transition: transform 0.2s ease;
      overflow: hidden;
      box-sizing: border-box;
    }

    .statement-view-container { 
      padding-bottom: 5cm;
      display: flex;
      flex-direction: column;
      align-items: center;
      width: 100%;
    }
    
    [contenteditable="true"]:hover { background: #f0f4ff; outline: 1px dashed #6366f1; cursor: text; border-radius: 2px; }
    
    .zoom-controls { position: fixed; bottom: 4rem; right: 2rem; z-index: 100; display: flex; flex-direction: column; gap: 0.75rem; }
    .zoom-btn { width: 45px; height: 45px; border-radius: 50%; display: flex; align-items: center; justify-content: center; background: var(--theme-primary); color: white; transition: transform 0.2s; }
    .zoom-btn:hover { transform: scale(1.1); }

    /* Skeleton Loader */
    .skeleton {
      background: linear-gradient(90deg, #1f2937 25%, #374151 50%, #1f2937 75%);
      background-size: 200% 100%;
      animation: skeleton-loading 1.5s infinite;
      border-radius: 4px;
    }
    @keyframes skeleton-loading { 0% { background-position: 200% 0; } 100% { background-position: -200% 0; } }

    /* PDF Generation Helper */
    #pdf-export-temp {
      position: fixed; left: 0; top: 0; width: 100%; height: 100%; z-index: -100; pointer-events: none; opacity: 0;
    }

    /* Color balls hover effect */
    .color-ball { transition: transform 0.2s, border-color 0.2s; cursor: pointer; }
    .color-ball:hover { transform: scale(1.2); border-color: white; }

    /* Print Logic */
    @media print {
      body { background: white !important; }
      .a4-page { margin: 0 !important; box-shadow: none !important; transform: none !important; width: 210mm !important; min-height: 297mm !important; }
      .no-print { display: none !important; }
    }

    tr { break-inside: avoid; page-break-inside: avoid; }
    
    /* Toggle Switch */
    .toggle-checkbox:checked { right: 0; border-color: #68D391; }
    .toggle-checkbox:checked + .toggle-label { background-color: #68D391; }
  </style>
</head>
<body class="flex flex-col min-h-screen">

  <div id="loading-bar-container" class="view-hidden fixed top-0 left-0 w-full h-1.5 z-[1000] bg-black/60">
    <div id="loading-bar" class="h-full w-0 bg-indigo-500 transition-all duration-300"></div>
  </div>
  
  <div id="pdf-export-temp" class="view-hidden"></div>

  <!-- Connection Hub Modal -->
  <div id="modal-config" class="modal-overlay view-hidden fixed inset-0 flex items-center justify-center p-4">
    <div class="glass-card p-6 md:p-10 w-full max-w-xl space-y-6 relative border-indigo-500/30 shadow-2xl">
      <button id="btn-close-config" class="absolute top-6 right-6 text-neutral-500 text-3xl hover:text-white">&times;</button>
      <h3 class="text-xl font-black uppercase tracking-tight">API Handshake</h3>
      
      <div class="space-y-4">
        <div class="p-4 bg-white/5 rounded-2xl border border-white/5">
          <p class="text-white font-black mb-2 uppercase text-[10px] tracking-widest">Authorized Redirect URI</p>
          <code class="block p-3 bg-black/50 rounded-xl border border-white/10 font-mono text-indigo-400 text-[10px] break-all select-all" id="display-redirect-uri"></code>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div class="col-span-2">
            <label class="block text-[9px] text-neutral-500 font-black mb-1.5 uppercase tracking-widest">Zoho Data Center</label>
            <select id="cfg-region" class="w-full text-xs font-bold">
              <option value="com">Global / US (zoho.com)</option>
              <option value="in">India (zoho.in)</option>
              <option value="eu">Europe (zoho.eu)</option>
              <option value="com.au">Australia (zoho.com.au)</option>
            </select>
          </div>
          <div class="col-span-2">
            <label class="block text-[9px] text-neutral-500 font-black mb-1.5 uppercase tracking-widest">Client ID (SPA Type Required)</label>
            <input id="cfg-client-id" type="text" placeholder="1000.XXXX..." class="w-full text-xs font-mono">
          </div>
        </div>
      </div>

      <div class="flex gap-4 pt-4">
        <button id="btn-reset-config" class="flex-1 py-4 bg-red-600/10 text-red-500 rounded-2xl font-black uppercase text-[10px]">Purge Cache</button>
        <button id="btn-save-config" class="flex-[2] py-4 bg-indigo-600 text-white rounded-2xl font-black uppercase text-[10px] shadow-xl">Apply Changes</button>
      </div>
    </div>
  </div>

  <!-- Landing Screen -->
  <div id="view-landing" class="flex-grow flex flex-col items-center justify-center p-6 text-center">
    <div class="glass-card p-10 md:p-20 max-w-2xl w-full flex flex-col items-center shadow-2xl relative overflow-hidden">
      <img src="https://i.ibb.co/7mmBhMJ/LOGO.png" alt="Logo" class="h-24 mb-10">
      <h1 class="text-5xl md:text-7xl font-black mb-4 uppercase tracking-tighter leading-none">BIZSENSE<br><span class="text-indigo-500">PRO</span></h1>
      
      <div id="landing-error" class="view-hidden my-6 p-4 bg-red-500/10 border border-red-500/20 rounded-2xl text-red-400 text-xs text-left w-full">
        <p class="font-black uppercase mb-1">Authorization Error</p>
        <p id="landing-error-text" class="opacity-80"></p>
      </div>
      
      <div class="flex flex-col md:flex-row gap-5 w-full max-w-md mt-6">
        <button id="btn-connect" class="flex-[2] py-6 bg-indigo-600 text-white rounded-3xl font-black uppercase text-[11px] tracking-[0.2em] shadow-2xl hover:bg-indigo-700">Authorize Access</button>
        <button id="btn-open-config-landing" class="flex-1 py-6 bg-white/5 text-neutral-300 rounded-3xl font-black uppercase text-[11px] border border-white/10">Settings</button>
      </div>
    </div>
  </div>

  <!-- Dashboard -->
  <div id="view-dashboard" class="view-hidden flex flex-col h-screen overflow-hidden">
    <header class="p-2 md:p-3 glass-card m-2 md:m-3 flex flex-col md:flex-row items-start md:items-center justify-between no-print gap-3">
      <div class="flex items-center space-x-6">
        <img src="https://i.ibb.co/7mmBhMJ/LOGO.png" alt="Logo" class="h-6 md:h-8">
        <div class="flex flex-col">
          <label class="text-[8px] font-black uppercase text-indigo-400 mb-1">Active Project</label>
          <select id="select-organization" class="font-black uppercase"></select>
        </div>
      </div>
      
      <!-- Date Range & Tools -->
      <div class="flex flex-wrap items-center gap-2 bg-black/40 rounded-xl p-1 border border-white/5">
        <select id="date-range-preset" class="text-[9px] font-black uppercase bg-transparent border-none text-white focus:ring-0 cursor-pointer">
          <option value="all">All History</option>
          <option value="this_month">This Month</option>
          <option value="last_month">Last Month</option>
          <option value="this_year">This Year</option>
          <option value="custom">Custom Range</option>
        </select>
        <div id="custom-date-container" class="hidden flex items-center gap-1 border-l border-white/10 pl-2">
            <input type="date" id="date-start" class="bg-transparent border border-white/10 rounded text-[9px] w-24 text-white">
            <span class="text-white">-</span>
            <input type="date" id="date-end" class="bg-transparent border border-white/10 rounded text-[9px] w-24 text-white">
        </div>
        
        <div class="w-px h-6 bg-white/10 mx-1"></div>

        <div class="flex items-center gap-2 px-2">
            <span class="text-[8px] font-black uppercase text-neutral-400">Detailed</span>
            <div class="relative inline-block w-8 mr-2 align-middle select-none transition duration-200 ease-in">
                <input type="checkbox" name="toggle" id="toggle-summary" class="toggle-checkbox absolute block w-4 h-4 rounded-full bg-white border-4 appearance-none cursor-pointer border-indigo-900 left-0 checked:right-0 checked:left-auto"/>
                <label for="toggle-summary" class="toggle-label block overflow-hidden h-4 rounded-full bg-indigo-900 cursor-pointer border border-white/10"></label>
            </div>
        </div>

        <div class="w-px h-6 bg-white/10 mx-1"></div>

        <button id="btn-email-composer" class="p-2 text-neutral-400 hover:text-white" title="Compose Email"><svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/></svg></button>
      </div>

      <div class="flex items-center space-x-3">
        <button id="btn-project-settings" class="p-2 text-neutral-500 hover:text-white" title="Sync Settings"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4"/></svg></button>
        <button id="btn-logout" class="p-2 text-neutral-500 hover:text-red-500" title="Secure Logout"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4"/></svg></button>
      </div>
    </header>

    <div class="flex flex-grow overflow-hidden px-2 md:px-4 pb-2 md:pb-4 gap-4">
      <aside class="hidden lg:flex w-80 flex-col gap-4 no-print">
        <div class="glass-card p-6 flex-grow flex flex-col overflow-hidden">
          <div class="flex justify-between items-center mb-4">
            <h4 class="text-[10px] font-black uppercase tracking-widest text-indigo-400">Registry</h4>
            <div class="flex gap-1">
              <span class="text-[8px] font-black bg-white/5 px-2 py-1 rounded text-neutral-500">ARROW KEYS NAV</span>
            </div>
          </div>
          <input type="text" id="customer-search" placeholder="Search customer..." class="w-full mb-4 text-xs">
          <div id="customer-list" class="flex-grow overflow-y-auto space-y-1 custom-scrollbar"></div>
        </div>
      </aside>

      <main class="flex-grow glass-card flex flex-col overflow-hidden relative">
        <div id="view-ledger-container" class="flex flex-col flex-grow overflow-hidden">
          <div class="p-3 md:p-4 border-b border-white/5 flex justify-between items-center bg-white/[0.01] no-print">
            <div class="flex items-center gap-4">
              <div class="flex gap-2">
                <button id="btn-download-pdf" disabled class="px-4 py-2 bg-indigo-600 text-white text-[9px] font-black uppercase rounded-xl disabled:opacity-30 hover:bg-indigo-700 transition-colors">Export PDF</button>
                <button id="btn-download-excel" disabled class="px-4 py-2 bg-emerald-600 text-white text-[9px] font-black uppercase rounded-xl disabled:opacity-30 hover:bg-emerald-700 transition-colors">Export Excel</button>
              </div>
              <div class="h-6 w-px bg-white/10"></div>
              <div id="color-theme-picker" class="flex items-center gap-2">
                <!-- Color balls injected by JS -->
              </div>
            </div>
            
            <div class="flex items-center gap-3">
               <label class="text-[9px] font-black uppercase text-neutral-500">Business Logo</label>
               <input type="file" id="logo-upload" accept="image/*" class="view-hidden">
               <button onclick="document.getElementById('logo-upload').click()" class="px-3 py-1.5 bg-white/5 border border-white/10 rounded-lg text-[8px] font-black uppercase hover:bg-white/10">Update Logo</button>
            </div>
          </div>

          <div id="area-ledger" class="flex-grow overflow-auto bg-[#040408] p-4 md:p-12 relative custom-scrollbar">
            <div class="zoom-controls no-print">
              <button id="btn-zoom-in" class="zoom-btn font-bold">+</button>
              <button id="btn-zoom-out" class="zoom-btn font-bold">-</button>
              <button id="btn-zoom-fit" class="zoom-btn">â¤¢</button>
            </div>
            
            <!-- Skeleton Loader State -->
            <div id="skeleton-loader" class="statement-view-container view-hidden">
                <div class="bg-white p-[1.5cm] w-[21cm] min-h-[29.7cm] shadow-2xl relative">
                    <div class="flex justify-between mb-12">
                        <div class="w-1/2 space-y-4">
                            <div class="skeleton h-16 w-32"></div>
                            <div class="skeleton h-8 w-64"></div>
                            <div class="skeleton h-24 w-48 mt-8"></div>
                        </div>
                        <div class="w-1/3 space-y-4 flex flex-col items-end">
                            <div class="skeleton h-12 w-24"></div>
                            <div class="skeleton h-32 w-full rounded-xl"></div>
                        </div>
                    </div>
                    <div class="space-y-3">
                        <div class="skeleton h-8 w-full"></div>
                        <div class="skeleton h-6 w-full"></div>
                        <div class="skeleton h-6 w-full"></div>
                        <div class="skeleton h-6 w-full"></div>
                        <div class="skeleton h-6 w-full"></div>
                    </div>
                </div>
            </div>

            <div id="statement-render-target" class="statement-view-container"></div>
            
            <div id="empty-state" class="flex flex-col items-center justify-center py-40 opacity-20">
              <svg class="w-16 h-16 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/></svg>
              <p class="font-black uppercase tracking-[0.4em] text-xs">Customer Selection Required</p>
            </div>
          </div>
        </div>

        <div id="view-explorer-container" class="view-hidden flex flex-col flex-grow overflow-hidden">
          <div class="p-4 border-b border-white/5 flex gap-4 bg-black/40" id="explorer-tabs"></div>
          <div class="flex-grow overflow-auto custom-scrollbar bg-[#040408]" id="explorer-table-container">
            <table class="w-full text-left explorer-table" id="explorer-master-table">
              <thead class="sticky top-0 bg-[#080810] z-10" id="explorer-thead"></thead>
              <tbody id="explorer-tbody"></tbody>
            </table>
          </div>
        </div>
        
        <div class="h-8 border-t border-white/5 bg-black/60 flex items-center px-6 font-mono text-[9px] text-neutral-700 justify-between no-print">
          <span id="log-message" class="uppercase">ENGINE_STABLE</span>
          <span id="data-stats" class="text-[8px] uppercase font-black text-indigo-900">0 RECORDS MAPPED</span>
        </div>
      </main>
    </div>
  </div>

  <!-- Settings Modal -->
  <div id="modal-settings" class="modal-overlay view-hidden fixed inset-0 flex items-center justify-center p-4">
    <div class="glass-card p-8 w-full max-w-lg space-y-6 shadow-2xl">
      <h3 class="text-xl font-black uppercase tracking-tight">Dataset Control</h3>
      <p class="text-[10px] text-neutral-500 font-bold uppercase tracking-widest">Select Zoho modules to analyze</p>
      <div id="module-selector" class="grid grid-cols-2 gap-3">
        <label class="p-4 bg-white/5 border border-white/5 rounded-xl flex items-center gap-3 cursor-pointer hover:border-indigo-500/50">
          <input type="checkbox" value="invoices" checked class="accent-indigo-500 w-4 h-4">
          <span class="text-xs font-bold uppercase tracking-widest">Invoices</span>
        </label>
        <label class="p-4 bg-white/5 border border-white/5 rounded-xl flex items-center gap-3 cursor-pointer hover:border-indigo-500/50">
          <input type="checkbox" value="estimates" class="accent-indigo-500 w-4 h-4">
          <span class="text-xs font-bold uppercase tracking-widest">Estimates</span>
        </label>
        <label class="p-4 bg-white/5 border border-white/5 rounded-xl flex items-center gap-3 cursor-pointer hover:border-indigo-500/50">
          <input type="checkbox" value="salesorders" class="accent-indigo-500 w-4 h-4">
          <span class="text-xs font-bold uppercase tracking-widest">Sales Orders</span>
        </label>
        <label class="p-4 bg-white/5 border border-white/5 rounded-xl flex items-center gap-3 cursor-pointer hover:border-indigo-500/50">
          <input type="checkbox" value="creditnotes" class="accent-indigo-500 w-4 h-4">
          <span class="text-xs font-bold uppercase tracking-widest">Credit Notes</span>
        </label>
      </div>
      <div class="flex gap-4 pt-4">
        <button id="btn-close-settings" class="flex-1 py-4 bg-white/5 border border-white/10 rounded-xl font-black uppercase text-[10px]">Cancel</button>
        <button id="btn-apply-settings" class="flex-1 py-4 bg-indigo-600 text-white rounded-xl font-black uppercase text-[10px] shadow-lg">Refresh Sync</button>
      </div>
    </div>
  </div>

  <script type="module" src="index.js"></script>
</body>
</html>